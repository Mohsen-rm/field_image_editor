<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>0. Design</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link
      type="text/css"
      href="https://uicdn.toast.com/tui-color-picker/v2.2.6/tui-color-picker.css"
      rel="stylesheet"
    />
    <link type="text/css" href="../dist/tui-image-editor.css" rel="stylesheet" />
    <style>
        @import url(https://fonts.googleapis.com/earlyaccess/thabit.css);
      /* @import url(http://fonts.googleapis.com/css?family=Noto+Sans); */
      html,
      body {
        height: 100%;
        margin: 0;
      }

      @font-face {
        font-family: "Bitstream Vera Serif Bold";
        src: url("https://mdn.github.io/css-examples/web-fonts/VeraSeBd.ttf");
      }

      body { font-family: "Bitstream Vera Serif Bold", serif }

      .arrow{
        width: 150px;
        height: 80px;
        background-color: yellow;
        -ms-transform: rotate(90deg); /* IE 9 */
        transform: rotate(90deg);
      }

      .box_words{
        float: right;
        background-color: red;
      }

      .button_select {
        background-color:#008CBA; /* Green */
        border: none;
        color: white;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        cursor: pointer;
      }

      #btnControl {
          display: none;
      }

      #btnControl:checked + label {
          width: 70px;
          height: 74px;
          color: red;
      }
    </style>
  </head>
  <body>
    <div id="tui-image-editor-container"></div>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.4.0/fabric.js"
    ></script>
    <script
      type="text/javascript"
      src="https://uicdn.toast.com/tui.code-snippet/v1.5.0/tui-code-snippet.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://uicdn.toast.com/tui-color-picker/v2.2.6/tui-color-picker.js"
    ></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js"></script>
    <script type="text/javascript" src="../dist/tui-image-editor.js"></script>
    <script type="text/javascript" src="js/theme/white-theme.js"></script>
    <script type="text/javascript" src="js/theme/black-theme.js"></script>

    <script>
      // Image editor
      var imageEditor = new tui.ImageEditor('#tui-image-editor-container', {
        includeUI: {
          loadImage: {
            path: 'img/sampleImage2.png',
            name: 'SampleImage',
          },
          theme: blackTheme, // or whiteTheme
          initMenu: 'filter',
          menuBarPosition: 'bottom',
        },
        cssMaxWidth: 700,
        cssMaxHeight: 500,
        usageStatistics: false,
      });
      window.onresize = function () {
        imageEditor.ui.resizeEditor();
      };

      var TextSelection = "";
      var html_check_boxs = "";

      function Adarrow(){
        // if (imageEditor.getDrawingMode() === 'FREE_DRAWING') {
        //     imageEditor.stopDrawingMode();
        // }
        //
        // imageEditor.startDrawingMode('FREE_DRAWING', {
        //      width: 10,
        //      color: 'rgba(255,0,0,0.5)'
        // });



        imageEditor.startDrawingMode('LINE_DRAWING', {
             width: 3,
             color: 'rgba(255,0,0,0.5)',
             arrowType: {
                 tail: 'chevron' // triangle
             }
        });
      }

      function Addarrow(){
          Adarrow();
      }

      const words = ["مرشوش","معجون ورش","حكه","تعديل","لحام","مفكوك","مغير","سماكه","لكر","القزاز مغير","القزاز مكسور","ملاحظة"];

      var select_words = new Array();
      // var number_increase = 6;
      var number_box_run = 6;
      for(var i = 0; i < words.length; i++) {
        if(number_box_run == i+1){
          number_box_run = number_box_run + 6;
          html_check_boxs = html_check_boxs + '<div class="tui-image-editor-checkbox" style="margin:5px;">'+
                                '<label style="margin:5px; width:20px;">'+
                                    '<input type="checkbox" onclick="OnSelection('+i+')" class="checkword1" id="checkword1">'+
                                    '<span style="margin-right:10px;">'+words[i]+'</span>'+
                                '</label>'+
                            '</div><br>';
        }else {
          html_check_boxs = html_check_boxs + '<div class="tui-image-editor-checkbox" style="margin:5px;">'+
                                '<label>'+
                                    '<input type="checkbox" onclick="OnSelection('+i+')" class="checkword1" id="checkword1">'+
                                    '<span style="margin-right:10px;">'+words[i]+'</span>'+
                                '</label>'+
                            '</div>';
        }
      }

      $(".tui-image-editor-submenu-item").find(".tie-text-align-button").append('<div class="tui-image-editor-button addrow">'+
                '<div>'+
                    '<svg id="btnaddro" onclick="Addarrow()" style="color:#8A8A8A;" xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-arrow-up-right" viewBox="0 0 16 16">'+
                      '<path fill-rule="evenodd" d="M14 2.5a.5.5 0 0 0-.5-.5h-6a.5.5 0 0 0 0 1h4.793L2.146 13.146a.5.5 0 0 0 .708.708L13 3.707V8.5a.5.5 0 0 0 1 0v-6z"/>'+
                    '</svg>'+
                '</div>'+
                '<label>سهم</label>'+
            '</div>');

      $(".tie-text-effect-button").append(
      '<li class="tie-text-effect-button" style="margin-left:30px;">'+
            '<div class="tui-image-editor-checkbox-wrap">'+html_check_boxs+
                '<br><button type="button" class="btn btn-primary button_select" onclick="CreateInputTextHorizontal()" style="border-radius: 12px; margin:5px;">أختيار أفقي</button>'+
                '<button type="button" class="btn btn-primary button_select" onclick="CreateInputTextVertical()" style="border-radius: 12px;  margin:5px;">أختيار عمودي</button>'+
            '</div>'+
        '</li>');

      function checkboxRestor(){
        for(let i = 0; i <= 6; i++) {
          $(".checkword"+i).prop('checked', false);
        }
      }


      function OnSelection(number){
        if(select_words.includes(words[number]+"•") == true){
          var index = select_words.indexOf(words[number]+"•");
          if (index !== -1) {
            select_words.splice(index, 1);
          }
        }else {
          select_words.push(words[number]+"•");
        }
      }

      function addTextAfterC(){

        try {
          imageEditor.stopDrawingMode();
        }
        catch(err) {

        }

        if(TextSelection !== ""){
          imageEditor.addText(TextSelection, {
              styles: {
                  fill: '#000',
                  fontSize: 25,
                  fontFamily:"Thabit",
                  textAlign:"right",
              },
          }).then(objectProps => {
              console.log("ID:"+objectProps.id);
          });

          TextSelection = "";
          select_words = [];
        }
      }

      function CreateInputTextHorizontal(){
        checkboxRestor();
        TextSelection = "";
        for(var i = 0; i < select_words.length; i++) {
          TextSelection = TextSelection + "" +select_words[i];
        }
        addTextAfterC();
      }

      function CreateInputTextVertical(){
        checkboxRestor();
        TextSelection = "";
        for(var i = 0; i < select_words.length; i++) {
          TextSelection = TextSelection+"\n"+ select_words[i];
        }
        var firstLineRemovedString = TextSelection.replace(/.*/, "").substr(1);
        TextSelection = firstLineRemovedString;
        addTextAfterC();
      }

      console.log(select_words);


    </script>

  </body>
</html>
